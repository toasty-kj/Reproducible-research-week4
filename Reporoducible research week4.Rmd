---
title: "Reproducible research course project week4"
author: "Koji"
date: "2021/11/15"
output: 
  html_document: 
    keep_md: true
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE)
```

#download files and read it
```{r, cache=TRUE}
Sys.setlocale(category = "LC_TIME", "C")
Sys.setenv("LANGUAGE"="e")
path <- getwd()
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(url, file.path(path, "NOAA_data.csv.bz2"))
NOAA_data <- read.csv("NOAA_data.csv.bz2")
summary(NOAA_data)
head(NOAA_data, 5)
names(NOAA_data)
```

#Across the United States, which types of events (as indicated in the \color{red}{\verb|EVTYPE|}EVTYPE variable) are most harmful with respect to population health?
    
#Across the United States, which types of events have the greatest economic consequences?

#Across the US, which types of events are most harmful with respect to population health?
#calculate mean value for each event type by aggregate function
```{r, cache=TRUE}
fatalities_byevent <- aggregate(FATALITIES ~ EVTYPE, data = NOAA_data, mean, na.rm = TRUE)
injuries_byevent <- aggregate(INJURIES ~ EVTYPE, data = NOAA_data, mean, na.rm = TRUE)
summary(fatalities_byevent)
summary(injuries_byevent)
max(fatalities_byevent$FATALITIES)
max(injuries_byevent$INJURIES)
fatalities_byevent$EVTYPE[which.max(fatalities_byevent$FATALITIES)]
injuries_byevent$EVTYPE[which.max(injuries_byevent$INJURIES)]
```

#Across the US, which types of events have the greatest economic consequences?
convert unit k and m into actual numbers
```{r, cache=TRUE}
# mutate new column reflecting units thousand K and million M
NOAA_data <- mutate(NOAA_data, PROPDMGNM = PROPDMG)
NOAA_data <- mutate(NOAA_data, CROPDMGNM = CROPDMG)
for (i in 1:length(NOAA_data)){
  if (NOAA_data$PROPDMGEXP[i] == "K"){
    NOAA_data$PROPDMGNM[i] <- NOAA_data$PROPDMG[i] * 1000
    if (NOAA_data$PROPDMGEXP[i] == "M"){
      NOAA_data$PROPDMGNM[i] <- NOAA_data$PROPDMG[i] * 1000000
    }
  }
 if (NOAA_data$CROPDMGEXP[i] == "K"){
    NOAA_data$CROPDMGNM[i] <- NOAA_data$CROPDMG[i] * 1000
    if (NOAA_data$CROPDMGEXP[i] == "M"){
      NOAA_data$CROPDMGNM[i] <- NOAA_data$CROPDMG[i] * 1000000
    }
 }
}
head(NOAA_data)
```

#calculate mean value for each event type by aggregate function
```{r, cache=TRUE}
propdmg_byevent <- aggregate(PROPDMGNM ~ EVTYPE, data = NOAA_data, mean, na.rm = TRUE)
cropdmg_byevent <- aggregate(CROPDMGNM ~ EVTYPE, data = NOAA_data, mean, na.rm = TRUE)
summary(propdmg_byevent)
summary(cropdmg_byevent)
```

#find which types of event have the greatest economic consequences
```{r, cache=TRUE}
propdmg_byevent$EVTYPE[which.max(propdmg_byevent$PROPDMGNM)]
cropdmg_byevent$EVTYPE[which.max(cropdmg_byevent$CROPDMGNM)]

```

